/*! Copyright (c) Microsoft Corporation. All rights reserved. */
module.exports=function(e){var n={};function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(r,i,function(n){return e[n]}.bind(null,i));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=0)}([function(e,n,t){"use strict";var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)Object.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n.default=e,n};const i=t(1),o=r(t(3)),s=r(t(4)),a=r(t(5)),c=t(6);let u,l,p=void 0;function m(e,n){e.languageServiceHost.log&&e.languageServiceHost.log(`IntelliCode plugin: ${n}`)}e.exports=function(e){const n=e.typescript;let t;return{create:function(e){const r=Object.create(null);for(let n of Object.keys(e.languageService)){const t=e.languageService[n];t&&(r[n]=t.bind(e.languageService))}function f(){if(!p&&u)try{const n=s.readFileSync(u),t=Buffer.from([214,105,172,23,156,35,36,45,137,37,195,176,189,110,127,78,69,171,205,160,3,202,114,220,252,109,233,221,252,181,45,47]),r=Buffer.from([60,12,128,217,163,220,176,146,213,18,190,59,212,88,192,21]),i=o.createDecipheriv("aes-256-cbc",t,r),c=Buffer.concat([i.update(n),i.final()]),f=a.gunzipSync(c);p=JSON.parse(f.toString("utf-8")),l="typescript_"+(p.Version||"unknown"),m(e,`successfully loaded model from ${u}`)}catch(n){m(e,`failed to load model from ${u}, exception: ${n}`)}return p}return e.config.modelPath&&(u=e.config.modelPath),t=e.languageServiceHost,m(e,`starting configuration: ${JSON.stringify(e.config)}`),r.getCompletionsAtPosition=((t,r,o)=>(function(e,n,t,r,o,s){const a=n.languageService.getCompletionsAtPosition(r,o,s),u=n.languageService.getProgram(),p=u?u.getSourceFile(r):void 0;if(a&&(a.entries.length>0||!p||!c.isInString(e,p,o))){const s=process.hrtime(),c=function(){const s=t(),a=s&&s.model;if(!a)return{recommendedWords:[],failureReason:"NoModelAvailable"};let c;const u=n.languageService.getProgram();if(!u)return{recommendedWords:[],failureReason:"NoProgramFound"};m(n,"program found");const l=u.getTypeChecker(),p=u.getSourceFile(r);if(!p)return{recommendedWords:[],failureReason:"NoSourceFileFound"};if(m(n,"source file found"),e.forEachChild(p,function t(r,s,a,u){function l(e,...n){e&&t(r,s,!0,e);for(const e of n)e&&t(r,s,a,e)}e.isPropertyAccessExpression(u)&&o>u.getStart()&&o<=u.getEnd()&&function(t,r,s,a){m(n,`found desired node ${u.kind} ${u.getStart()} ${u.getEnd()} ${o}: ${u.getText(r)}`);const l=i.getTypeNameForPythia(e,i.GetTypeNameOptions.SkipAny,t,a.expression,r).typeName;l&&m(n,`found type name too! ${(c={typeName:l,node:a,isInConditional:s,sf:r}).typeName} ${s?"in conditional":""}`)}(r,s,a,u),e.isIfStatement(u)?l(u.expression,u.thenStatement,u.elseStatement):e.isConditionalExpression(u)?l(u.condition,u.whenTrue,u.whenFalse):e.isDoStatement(u)||e.isWhileStatement(u)?l(u.expression,u.statement):e.isForStatement(u)?l(u.condition,u.initializer,u.incrementor,u.statement):u.forEachChild(t.bind(void 0,r,s,a))}.bind(void 0,l,p,!1)),!c)return{recommendedWords:[],failureReason:"NoNodeFound"};let f=void 0,d=[];m(n,`determined type: ${c.typeName}`);const g=a[c.typeName];if(g){m(n,"found some suggestion stuff");const t=function(t){const r=[];(function t(r,o,s,a){if(o.getStart()>s.getStart())return!0;if(o.forEachChild(e=>t(r,e,s,a)),e.isPropertyAccessExpression(o)&&o.expression!=s){const t=i.getTypeNameForPythia(e,i.GetTypeNameOptions.SkipAny,l,o.expression,c.sf).typeName;t===r&&o.name.text&&(m(n,`pushing prior access: ${o.name.text}`),a.push(o.name.text))}})(t,c.sf,c.node,r),r.reverse(),m(n,`prior accesses: ${r.join(",")}`);const o=[];return o.push("N"),r.length>0&&o.push("N~"+r[0]),r.length>1&&o.push(r[0]+"~"+r[1]),o.reverse(),m(n,`sequences: ${o.join(",")}`),o}(c.typeName);m(n,`sequences: ${t.join(",")}`);for(const e of t){const t=g[e],r=t&&(c.isInConditional?t[1]:t[0]);if(r){f=e,m(n,`found suggestions for sequence ${e} : ${r.join(",")}`),d.push(...r.slice(0,5));break}}}return{typeName:c.typeName,inConditional:c.isInConditional,sequenceString:f,recommendedWords:d,failureReason:"None"}}(),u=1e6,p=1e9,d=process.hrtime(s),g=(d[0]*p+d[1])/u;let y="None"===c.failureReason?"NotInModel":c.failureReason,S=[];c.recommendedWords.length>0&&(y="NotInIntersection",a.entries=a.entries.filter(e=>!e.replacementSpan||!e.insertText||"["!==e.insertText[0]),a.entries.some(e=>"0"===e.sortText)?c.recommendedWords.forEach((e,t)=>{const r=a.entries.findIndex(n=>n.name===e);if(r>=0){const e=a.entries[r];m(n,`marking recommendation ${e.name}`),y="None",f(e,t),S.push(e),a.entries.splice(r,1)}}):(m(n,"no strong recommendations, adding entries"),a.entries=a.entries.filter(e=>!c.recommendedWords.some(n=>e.name===n)),S=c.recommendedWords.map((n,t)=>{const r={name:n,kind:e.ScriptElementKind.memberVariableElement,sortText:"0"};return f(r,t),r})),a.entries=S.concat(a.entries));const x=function(e,n,t){return{Id:Date.now(),ModelVersion:l||"typescript_unknown",Count:0,FailureReason:e,Class:"",InIf:n.inConditional,ElapsedTime:t,Methods:[],PrevInvoc:"",ItemMetadata:Object.create(null)}}(y,c,g);c.typeName&&c.sequenceString&&(x.Count=S.length,x.ModelType=c.sequenceString&&"N"!==c.sequenceString?"Sequence":"Frequency",x.Class="NotInModel"!==y?c.typeName:"",x.Methods=S.map(e=>e.insertText),x.PrevInvoc=c.sequenceString,a.entries.forEach((e,t)=>{const r={Id:x.Id,Index:t,Method:t<S.length?e.insertText:""};x.ItemMetadata[e.name]=r,m(n,`adding item metadata ${e.name} => ${JSON.stringify(r)} to completion result`)})),m(n,`added metadata ${JSON.stringify(x)} to completion result`),a.metadata=x}function f(e,t){e.insertText=e.insertText||e.name,e.sortText=e.sortText||e.name,e.name="★ "+e.name,e.sortText=`*${String.fromCharCode("a".charCodeAt(0)+t)} ${e.sortText}`,m(n,`sort text for entry ${e.name} is ${e.sortText}`)}return a})(n,e,f,t,r,o)),r.getCompletionEntryDetails=((n,t,r,i,o,s)=>(function(e,n,t,r,i,o,s,a,c){const u=o.startsWith("★ "),l=u?o.slice("★ ".length):o;u&&m(n,`stripped name for recommendation: ${l}`);const p=n.languageService.getCompletionEntryDetails(r,i,l,s,a,c);return p&&u&&(p.name="★ "+p.name,m(n,`starred name for recommendation: ${p.name}`)),p})(0,e,0,n,t,r,i,o,s)),r},onConfigurationChanged:function(e){t&&t.log(`received configuration command: ${JSON.stringify(e)}`),e.modelPath&&(u=e.modelPath)}}}},function(e,n,t){"use strict";n.__esModule=!0;var r,i,o=t(2);!function(e){e[e.DontSkipAny=0]="DontSkipAny",e[e.SkipAny=1]="SkipAny"}(r=n.GetTypeNameOptions||(n.GetTypeNameOptions={})),function(e){e[e.SkipAny=0]="SkipAny",e[e.Any=1]="Any",e[e.AnyCallExpression=2]="AnyCallExpression",e[e.AnyPropertyAccessExpression=3]="AnyPropertyAccessExpression",e[e.AnyElementAccessExpression=4]="AnyElementAccessExpression",e[e.UnionOrIntersection=5]="UnionOrIntersection",e[e.OtherPrimitive=6]="OtherPrimitive",e[e.OtherNonPrimitive=7]="OtherNonPrimitive",e[e.Literal=8]="Literal",e[e.EmptyIdentifier=9]="EmptyIdentifier"}(i=n.SkipTypeReason||(n.SkipTypeReason={})),n.getTypeNameForPythia=function e(n,t,s,a,c){var u=s.getTypeAtLocation(a),l=u.aliasSymbol||u.getSymbol();if(l){if(0!=(l.flags&(n.SymbolFlags.TypeLiteral|n.SymbolFlags.ObjectLiteral)))return{typeName:s.typeToString(u)};var p=s.getFullyQualifiedName(l);if(p&&'"'===p[0]){var m=(h=(x=p).indexOf('"',1))>=1?{partInQuotes:x.substring(1,h),rest:x.substring(h+1)}:{},f=m.partInQuotes,d=m.rest;if(f){var g=f;if(o.isAbsolute(g)){"index"===o.basename(g)&&(g=o.dirname(g));var y=g.lastIndexOf("/node_modules/");if(y>=0){var S=y+"/node_modules/".length;g=g.substring(S)}else g=o.basename(g);p='"'+g+'"'+(d||"")}}}return{typeName:p}}var x,h;if(0==(u.getFlags()&n.TypeFlags.NonPrimitive)){if(0!=(u.flags&n.TypeFlags.Any)){var N;if(n.isCallExpression(a))return(N=e(n,t,s,a.expression,c)).typeName?{typeName:N.typeName+"()"}:{skipReason:i.AnyCallExpression};if(n.isPropertyAccessExpression(a))return(N=e(n,t,s,a.expression,c)).typeName?{typeName:N.typeName+"."+a.name.text}:{skipReason:i.AnyPropertyAccessExpression};if(n.isElementAccessExpression(a))return(N=e(n,t,s,a.expression,c)).typeName?{typeName:N.typeName+"[]"}:{skipReason:i.AnyElementAccessExpression};if(t===r.SkipAny)return{skipReason:i.SkipAny};if(n.isIdentifier(a)){var v=a.text;return v?{typeName:v}:{skipReason:i.EmptyIdentifier}}return a.kind===n.SyntaxKind.ThisKeyword?{typeName:"this"}:{skipReason:i.Any}}return 0!=(u.flags&n.TypeFlags.StringLike)?{typeName:"string"}:0!=(u.flags&n.TypeFlags.Boolean)?{typeName:"boolean"}:0!=(u.flags&n.TypeFlags.NumberLike)?{typeName:"number"}:0!=(u.flags&n.TypeFlags.UnionOrIntersection)?{skipReason:i.UnionOrIntersection}:{skipReason:i.OtherPrimitive}}return{skipReason:i.OtherNonPrimitive}}},function(e,n){e.exports=require("path")},function(e,n){e.exports=require("crypto")},function(e,n){e.exports=require("fs")},function(e,n){e.exports=require("zlib")},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isInString=function(e,n,t){const r=function(n,t){let r=n;e:for(;;){for(const i of r.getChildren(n)){const o=i.getStart(n);if(o>t)break;const s=i.getEnd();if(t<s||t===s&&i.kind===e.SyntaxKind.EndOfFileToken){r=i;continue e}}return r}}(n,t);if(r&&(e.isStringLiteral(r)||e.isTemplateLiteralToken(r))){const e=r.getStart(n),i=r.getEnd();if(e<t&&t<i)return!0;if(t===i)return!!r.isUnterminated}}}]);